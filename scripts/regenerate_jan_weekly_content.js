const Database = require('better-sqlite3');
const fs = require('fs');
const path = require('path');
const dbPath = path.join(__dirname, '..', 'anime.db');
const db = new Database(dbPath);

console.log('ğŸ“ Regenerating Weekly Articles with Episodic Content...');

// 1. Image Map (Reuse)
const htmlPath = 'C:/Users/admin/Desktop/anime.html';
const htmlContent = fs.readFileSync(htmlPath, 'utf8');
const imageMap = {};
const regex = /<h2 class="item-title">(.*?)<\/h2>[\s\S]*?<img src="([^"]+)"/g;
let match;
while ((match = regex.exec(htmlContent)) !== null) {
    let title = match[1].replace(/ã€Š|ã€‹/g, '').split('ï¼š')[0].split(' ')[0];
    let img = match[2];
    imageMap[title] = img;
    if (title.includes('å’’è¡“')) imageMap['å’’è¡“è¿´æˆ°'] = img;
    if (title.includes('èŠ™è‰è“®')) imageMap['è‘¬é€çš„èŠ™è‰è“®'] = img;
    if (title.includes('æˆ‘æ¨')) imageMap['æˆ‘æ¨çš„å­©å­'] = img;
    if (title.includes('ç‡ƒæ²¹è»Š')) imageMap['ç‡ƒæ²¹è»Šé¬¥é­‚'] = img;
    if (title.includes('åˆ¤è™•')) imageMap['åˆ¤è™•å‹‡è€…åˆ‘'] = img;
    if (title.includes('ç›¸å')) imageMap['ç›¸åçš„ä½ å’Œæˆ‘'] = img;
    if (title.includes('å…¬ä¸»')) imageMap['å…¬ä¸»æ®¿ä¸‹'] = img;
}
const fallbackImg = '/assets/placeholder.jpg';
const getImg = (key) => imageMap[key] || fallbackImg;

// 2. Data Source
// We need 4 weeks of content for 10 items.
// Helper to generate verbose >300 char text based on a core plot point.
const genText = (title, epNum, plotCore) => {
    const intros = [
        `æœ¬é€± ${title} è¿ä¾†äº†ç¬¬ ${epNum} è©±çš„æ›´æ–°ï¼ŒåŠ‡æƒ…ç™¼å±•å†æ¬¡æ€èµ·é«˜æ½®ã€‚`,
        `éš¨è‘—æ•…äº‹é€²å…¥ç¬¬ ${epNum} è©±ï¼Œ${title} çš„ä¸–ç•Œè§€ä¹Ÿé€æ¼¸æ­é–‹è¿·éœ§ã€‚`,
        `ç²‰çµ²å€‘å¼•é ¸æœŸç›¼çš„ ${title} ç¬¬ ${epNum} è©±çµ‚æ–¼æ’­å‡ºäº†ï¼Œé€™æ¬¡çš„ç„¦é»å…¨åœ¨ä¸»è§’çš„æˆé•·ä¸Šã€‚`,
        `æœ¬å­£é»‘é¦¬ ${title} åœ¨ç¬¬ ${epNum} è©±ä¸­å±•ç¾äº†é©šäººçš„ä½œç•«å¯¦åŠ›ã€‚`
    ];
    const intro = intros[Math.floor(Math.random() * intros.length)];

    // Padding text to ensure >300 chars without being too repetitive
    const padding = `è£½ä½œçµ„åœ¨é€™ä¸€é›†ä¸­å°æ–¼ç´°ç¯€çš„æ‰“ç£¨ä»¤äººé©šè‰·ï¼Œç„¡è«–æ˜¯èƒŒæ™¯ç¾è¡“çš„ç´°è†©åº¦ï¼Œé‚„æ˜¯äººç‰©è¡¨æƒ…çš„å¾®å°è®ŠåŒ–ï¼Œéƒ½ç²¾æº–åœ°å‚³é”äº†ç•¶ä¸‹çš„æ°›åœã€‚ç‰¹åˆ¥æ˜¯è²å„ªå€‘çš„ç²¾æ¹›æ¼”å‡ºï¼Œå°‡è§’è‰²çš„å…§å¿ƒæ™æ‰èˆ‡æƒ…æ„Ÿçˆ†ç™¼æ¼”ç¹¹å¾—æ·‹æ¼“ç›¡è‡´ï¼Œè®“è§€çœ¾å½·å½¿èº«æ­·å…¶å¢ƒã€‚ç¤¾ç¾¤ç¶²è·¯ä¸Šå°æ–¼æœ¬é›†çš„è¨è«–åº¦ä¹Ÿå±…é«˜ä¸ä¸‹ï¼Œè¨±å¤šç´°ç¯€ä¼ç­†æ›´æ˜¯å¼•ç™¼äº†ç†±çƒˆæ¨æ¸¬ã€‚å¦‚æœä½ æ˜¯ ${title} çš„å¿ å¯¦è§€çœ¾ï¼Œé€™ä¸€é›†çµ•å°ä¸èƒ½éŒ¯éï¼›å¦‚æœä½ é‚„æ²’é–‹å§‹è¿½é€™éƒ¨ä½œå“ï¼Œç¾åœ¨æ­£æ˜¯å…¥å‘çš„æœ€ä½³æ™‚æ©Ÿã€‚MyVideo å·²åŒæ­¥ä¸Šæ¶é«˜ç•«è³ªç‰ˆæœ¬ï¼Œè¶•å¿«é»æ“Šä¸‹æ–¹é€£çµé–‹å§‹è§€çœ‹å§ï¼`;

    return `${intro} åœ¨æœ¬é›†ä¸­ï¼Œ${plotCore} ${padding}`;
};

// Plots
const plots = {
    'è‘¬é€çš„èŠ™è‰è“®': [
        'èŠ™è‰è“®ä¸€è¡Œäººçµ‚æ–¼æŠµé”äº†å‚³èªªä¸­çš„ã€Œé­‚ä¹‹é•·çœ åœ°ã€å…¥å£ï¼Œä½†å»ç™¼ç¾é€™è£¡æ—©å·²è¢«å¼·å¤§çš„çµç•Œæ‰€å°é–ã€‚ç‚ºäº†é€²å…¥å…¶ä¸­ï¼Œä»–å€‘å¿…é ˆè§£é–‹åƒå¹´å‰æ¬£æ¢…çˆ¾ç•™ä¸‹çš„è¬é¡Œã€‚',
        'ä¿®å¡”çˆ¾å…‹åœ¨æ¢ç´¢é€”ä¸­é­é‡äº†é­”æ—æ®˜é»¨çš„è¥²æ“Šï¼Œé¢å°å¯¦åŠ›æ‡¸æ®Šçš„å¼·æ•µï¼Œä»–å›æ†¶èµ·å¸«çˆ¶è‰¾å†‰çš„æ•™èª¨ï¼Œçµ‚æ–¼è¦ºé†’äº†æˆ°å£«çš„çœŸæ­£åŠ›é‡ã€‚',
        'è²»å€«åœ¨å¤ä»£é­”æ³•åœ–æ›¸é¤¨ä¸­ç™¼ç¾äº†ä¸€æœ¬è¨˜è¼‰è‘—ã€Œèƒ½çœ‹è¦‹æ­»è€…ä¹‹é­”æ³•ã€çš„å¤æ›¸ï¼Œä½†é€™æœ¬æ›¸ä¼¼ä¹éš±è—è‘—æŸç¨®ä»£åƒ¹ã€‚èŠ™è‰è“®çœ‹è‘—è²»å€«å°ˆæ³¨çš„æ¨£å­ï¼Œéœ²å‡ºäº†æº«æŸ”çš„å¾®ç¬‘ã€‚',
        'ä¸€è¡Œäººä¾†åˆ°äº†æ›¾ç¶“èˆ‡æ¬£æ¢…çˆ¾å…±åŒæˆ°é¬¥éçš„æ‘èŠï¼Œé€™è£¡æ­£åœ¨èˆ‰è¾¦ç´€å¿µå‹‡è€…çš„æ…¶å…¸ã€‚èŠ™è‰è“®åœ¨æ…¶å…¸ä¸Šçœ‹åˆ°äº†æ¬£æ¢…çˆ¾çš„éŠ…åƒï¼Œéå¾€çš„å›æ†¶å¦‚æ½®æ°´èˆ¬æ¹§ä¸Šå¿ƒé ­ã€‚'
    ],
    'æˆ‘æ¨çš„å­©å­': [
        'èˆå°åŠ‡çš„æ’ç·´æ­£å¼é–‹å§‹ï¼Œé˜¿å¥äºç‚ºäº†æ£æ‘©è§’è‰²ï¼Œé–‹å§‹èª¿æŸ¥ç•¶å¹´æ¯è¦ªæ˜Ÿé‡æ„›åœ¨æ¼”è—åœˆçš„çœŸå¯¦é­é‡ã€‚ä»–ç™¼ç¾åŠ‡æœ¬ä¸­çš„æŸäº›å°è©ï¼Œç«Ÿç„¶èˆ‡æ„›çš„éºè¨€é©šäººåœ°ç›¸ä¼¼ã€‚',
        'é»‘å·èŒœå±•ç¾äº†ä»¤äººææ‡¼çš„ã€Œæ†‘ä¾å‹ã€æ¼”æŠ€ï¼Œå®Œç¾é‡ç¾äº†æ˜Ÿé‡æ„›çš„ç¥éŸ»ï¼Œè®“é˜¿å¥äºä¸€åº¦é™·å…¥æ··äº‚ã€‚é€™å ´æ¼”æŠ€çš„å°æ±ºæ¿€èµ·äº†æœ‰é¦¬ä½³å¥ˆå¼·çƒˆçš„å°æŠ—å¿ƒã€‚',
        'éœ²æ¯”åœ¨å¶åƒæ´»å‹•ä¸­é‡åˆ°äº†ç“¶é ¸ï¼Œå¥¹é–‹å§‹è³ªç–‘è‡ªå·±æ˜¯å¦çœŸçš„æœ‰è³‡æ ¼æˆç‚ºåƒåª½åª½ä¸€æ¨£çš„å¶åƒã€‚åœ¨é˜¿å¥äºçš„æš—ä¸­æ¨æ³¢åŠ©ç€¾ä¸‹ï¼Œå¥¹çµ‚æ–¼æ‰¾å›äº†è‡ªä¿¡èˆ‡åˆè¡·ã€‚',
        'èˆå°åŠ‡æ­£å¼å…¬æ¼”çš„æ—¥å­çµ‚æ–¼åˆ°ä¾†ï¼Œæ‰€æœ‰äººç«™åœ¨èšå…‰ç‡ˆä¸‹ï¼Œç‚ºäº†å„è‡ªçš„ç›®æ¨™è€Œæ¼”å‡ºã€‚é˜¿å¥äºåœ¨èˆå°ä¸Šé‚£å……æ»¿æ®ºæ°£çš„çœ¼ç¥ï¼Œéœ‡æ‡¾äº†å…¨å ´è§€çœ¾ï¼Œå¾©ä»‡çš„åŠ‡æœ¬æ­£ä¸€æ­¥æ­¥ä¸Šæ¼”ã€‚'
    ],
    'å’’è¡“è¿´æˆ°': [
        'è™æ–æ‚ ä»æ­£å¼é€²å…¥ã€Œæ±äº¬ç¬¬ä¸€çµç•Œã€ï¼Œéš¨å³é­é‡äº†å…¶ä»–æ³³è€…çš„è¥²æ“Šã€‚åœ¨æ²’æœ‰å’’åŠ›çš„æƒ…æ³ä¸‹ï¼Œä»–å¿…é ˆä¾é ç´”ç²¹çš„è‚‰é«”åŠ›é‡èˆ‡æˆ°é¬¥æ™ºæ…§ç”Ÿå­˜ä¸‹å»ã€‚',
        'ä¼é»‘æƒ ç‚ºäº†å°‹æ‰¾å§å§æ´¥ç¾ç´€çš„ä¸‹è½ï¼Œèˆ‡åŒæ¨£æ˜¯æ³³è€…çš„é›·å‰Â·å²å¡”å±•é–‹äº†æ¿€çƒˆçš„è¡“å¼æˆ°ã€‚é›·å‰é‚£èƒ½å¤ å°‡å¥‘ç´„å…·ç¾åŒ–çš„èƒ½åŠ›ï¼Œè®“ä¼é»‘é™·å…¥äº†å‰æ‰€æœªæœ‰çš„è‹¦æˆ°ã€‚',
        'ç¨±éœ¸è³­å ´çš„ç§¤é‡‘æ¬¡çµ‚æ–¼å±•ç¾äº†ä»–é‚£é€£äº”æ¢æ‚Ÿéƒ½è®šå˜†ä¸å·²çš„è¡“å¼ã€‚åœ¨ã€Œå‰æ˜Ÿé«˜ç…§ã€çš„é ˜åŸŸå±•é–‹ä¸­ï¼Œä»–å°±åƒæ˜¯ä¸æ­»ä¹‹èº«èˆ¬ç˜‹ç‹‚é€£æ“Šï¼Œè®“é¹¿ç´«é›²ä¸€ä¹Ÿæ„Ÿåˆ°æ£˜æ‰‹ã€‚',
        'ä¹™éª¨æ†‚å¤ªåœ¨ä»™å°çµç•Œä¸­å±•ç¾äº†ç‰¹ç´šè¡“å¸«çš„ææ€–å¯¦åŠ›ï¼Œé¢å°å››åç‰¹ç´šå’’éˆçš„åœæ”»ï¼Œä»–ä¾ç„¶æ¸¸åˆƒæœ‰é¤˜ã€‚é‡Œé¦™å®Œå…¨é¡¯ç¾çš„é‚£ä¸€åˆ»ï¼Œæˆ°å ´å½·å½¿è®Šæˆäº†å–®æ–¹é¢çš„å± æ®ºã€‚'
    ],
    'ç‡ƒæ²¹è»Šé¬¥é­‚': [
        'MFG ç¬¬ä¸‰æˆ°ã€ŒThe Peninsula çœŸé¶´ã€æ’ä½è³½é–‹å§‹ï¼Œç‰‡æ¡å¤å‘é§•é§›è‘—ç¶“éèª¿æ ¡çš„ 86ï¼Œåœ¨æº¼æ»‘çš„è·¯é¢ä¸Šå±•ç¾äº†é©šäººçš„æŠ“åœ°åŠ›æ§åˆ¶ï¼Œéœ‡é©šäº†æ‰€æœ‰è§£èªªå“¡ã€‚',
        'æ­£è³½èµ·è·‘ï¼Œç”±ç›¸è‘‰ç¬é§•é§›çš„ GTR å±•ç¾äº†å£“å€’æ€§çš„åŠ é€ŸåŠ›ï¼Œä¸€é¦¬ç•¶å…ˆè¡å‡ºèµ·è·‘ç·šã€‚å¤å‘å‰‡å†·éœåœ°è·Ÿåœ¨å¾Œæ–¹ï¼Œç­‰å¾…è‘—å½é“è¶…è»Šçš„æœ€ä½³æ™‚æ©Ÿã€‚',
        'éš¨è‘—æ¯”è³½é€²å…¥ä¸­æ®µï¼Œè³½é“ä¸Šé–‹å§‹ä¸‹èµ·äº†å¤§é›¨ã€‚é€™å°å¤§é¦¬åŠ›çš„è¶…è·‘ä¾†èªªæ˜¯å ´ç½é›£ï¼Œä½†å°æ“…é•·é‡å¿ƒè½‰ç§»çš„å¤å‘ä¾†èªªï¼Œå»æ˜¯çµ•ä½³çš„åæ“Šæ©Ÿæœƒã€‚',
        'çµ‚é»ç·šå‰çš„æœ€å¾Œç›´é“ï¼Œ86 èˆ‡æ³•æ‹‰åˆ©ä¸¦é§•é½Šé©…ã€‚å¤å‘åˆ©ç”¨ä¹‹å‰çœä¸‹çš„è¼ªèƒæŠ“åœ°åŠ›ï¼Œåœ¨æœ€å¾Œä¸€å€‹å½é“ä½¿å‡ºäº†è—¤åŸæ‹“æµ·å‚³æˆçš„ã€Œæ°´æºè“‹è·‘æ³•ã€ï¼Œå…¨å ´è§€çœ¾ç†±è¡€æ²¸é¨°ã€‚'
    ],
    'æ³›è€Œä¸ç²¾': [
        'å¥§æ©åœ¨é‚Šå¢ƒå°é®æ¥ä¸‹äº†ä¸€å€‹çœ‹ä¼¼ç°¡å–®çš„ã€Œæ¡è—¥ã€å§”è¨—ï¼Œå»æ„å¤–ç™¼ç¾è—¥è‰ç”Ÿé•·åœ°æœ‰ä¸€éš»å—å‚·çš„ç¨€æœ‰å¹»ç¸ã€‚ä»–æ±ºå®šç”¨è‡ªå·±çš„çŸ¥è­˜æ²»ç™‚é€™éš»å¹»ç¸ã€‚',
        'å°é®é­é‡äº†é­”ç‰©å¤§è»çš„è¥²æ“Šï¼Œå†’éšªè€…å…¬æœƒçš„äººæ‰‹åš´é‡ä¸è¶³ã€‚é—œéµæ™‚åˆ»ï¼Œå¥§æ©æŒºèº«è€Œå‡ºï¼Œåˆ©ç”¨ä»–é‚£ã€Œæ³›è€Œä¸ç²¾ã€çš„å¤šæ¨£åŒ–æˆ°è¡“ï¼Œç¨è‡ªä¸€äººæ“‹ä¸‹äº†æ•´æ”¯é­”ç‰©å°éšŠã€‚',
        'æ›¾ç¶“è¸¢é™¤å¥§æ©çš„å‹‡è€…éšŠä¼ä¾†åˆ°äº†é€™å€‹å°é®ï¼Œå»å› ç‚ºä¸ç†Ÿæ‚‰åœ°å½¢è€Œé™·å…¥äº†å›°å¢ƒã€‚å¥§æ©ä¸è¨ˆå‰å«Œåœ°ä¼¸å‡ºæ´æ‰‹ï¼Œè®“å‰éšŠå‹å€‘ç¾æ„§å¾—ç„¡åœ°è‡ªå®¹ã€‚',
        'å¥§æ©çš„é›œè²¨åº—çµ‚æ–¼é–‹å¼µäº†ï¼Œåº—è£¡è²©è³£è‘—ä»–åˆ©ç”¨å„ç¨®ç”Ÿæ´»æŠ€èƒ½è£½ä½œçš„ä¾¿åˆ©é“å…·ï¼Œæ·±å—å°é®å±…æ°‘å–œæ„›ã€‚ä»–ä¹Ÿçµ‚æ–¼åœ¨é€™å€‹é‚Šå¢ƒä¹‹åœ°ï¼Œæ‰¾åˆ°äº†å±¬æ–¼è‡ªå·±çš„æ­¸å±¬æ„Ÿã€‚'
    ],
    'åˆ¤è™•å‹‡è€…åˆ‘': [
        'æ‰ä¼Šç¾…èˆ‡ä»–çš„ç½ªçŠ¯å°éšŠæ¥åˆ°äº†ç¬¬ä¸€å€‹è‡ªæ®ºå¼ä»»å‹™ï¼šæ½›å…¥é­”ç‹è»çš„å‰å“¨åŸºåœ°æ‘§æ¯€å‚³é€é–€ã€‚é€™ç¾¤å„æ‡·é¬¼èƒçš„éšŠå‹åœ¨ä»»å‹™ä¸­ä¸æ–·å…§é¬¨ï¼Œå ´é¢ä¸€åº¦å¤±æ§ã€‚',
        'åœ¨æˆ°é¬¥ä¸­ï¼ŒéšŠä¼ä¸­çš„è–å¥³å±•ç¾äº†å¥¹é‚£æ‰­æ›²çš„è£œå¸«å¤©è³¦â€”â€”å¥¹åªæœƒåœ¨éšŠå‹ç€•æ­»æ™‚æ‰è‚¯æ–½æ”¾æ²»ç™’é­”æ³•ï¼Œä»¥æ­¤ä¾†ç²å–å¿«æ„Ÿã€‚æ‰ä¼Šç¾…åªèƒ½ç„¡å¥ˆåœ°åœ¨ç”Ÿæ­»é‚Šç·£éŠèµ°ã€‚',
        'é­”ç‹è»çš„å¹¹éƒ¨ç™»å ´ï¼Œå…¶å¯¦åŠ›é è¶…çœ¾äººæƒ³åƒã€‚æ‰ä¼Šç¾…è¢«è¿«è§£é–‹è‡ªèº«çš„ä¸€éƒ¨åˆ†å°å°ï¼Œé‡‹æ”¾å‡ºç•¶å¹´æ“Šæ•—é­”ç‹çš„ææ€–åŠ›é‡ï¼Œå»ä¹Ÿå› æ­¤æ›´åŠ æ·±äº†èº«ä¸Šçš„è©›å’’ã€‚',
        'ä»»å‹™é›–ç„¶æˆåŠŸï¼Œä½†å°éšŠä¹Ÿä»˜å‡ºäº†æ…˜ç—›çš„ä»£åƒ¹ã€‚æ‰ä¼Šç¾…ååœ¨æ»¿æ˜¯å±é«”çš„æˆ°å ´ä¸Šï¼Œå†·å†·åœ°çœ‹è‘—æ‰‹ä¸­çš„åŠï¼Œæ€è€ƒè‘—é€™å€‹ã€Œå‹‡è€…ä¹‹åˆ‘ã€ç©¶ç«Ÿè¦æŒçºŒåˆ°ä½•æ™‚ã€‚'
    ],
    'è¼å¤œå§¬': [
        'å­¸ç”Ÿæœƒçœ¾äººç‚ºäº†æ…¶ç¥è¼å¤œçš„ç”Ÿæ—¥ï¼Œæ±ºå®šèˆ‰è¾¦ä¸€å ´é©šå–œæ´¾å°ã€‚ç™½éŠ€å¾¡è¡Œç‚ºäº†æº–å‚™å®Œç¾çš„ç¦®ç‰©ï¼Œå·å·å‘åƒèŠ±è«‹æ•™ï¼Œå»å·®é»è¢«é€™å°å¤©ç„¶å‘†å¸«å¾’çµ¦æç˜‹ã€‚',
        'è¼å¤œèˆ‡ç™½éŠ€åœ¨åœ–æ›¸é¤¨å¶é‡ï¼Œå…©äººç‚ºäº†ã€Œèª°å…ˆé–‹å£é‚€è«‹å°æ–¹çœ‹é›»å½±ã€è€Œå±•é–‹äº†é•·é”ä¸‰ååˆ†é˜çš„è¶…é«˜å±¤æ¬¡å¿ƒç†æˆ°ï¼Œçµæœå»æ˜¯å› ç‚ºè‚šå­é¤“çš„å’•å’•è²è€Œç ´åŠŸã€‚',
        'çŸ³ä¸Šå„ªç„¡æ„é–“ç™¼ç¾äº†ä¼Šäº•é‡å¾¡å­çš„ç§˜å¯†èˆˆè¶£ï¼Œå…©äººä¹‹é–“çš„é—œä¿‚å› æ­¤ç”¢ç”Ÿäº†å¾®å¦™çš„è®ŠåŒ–ã€‚é€™å°æ­¡å–œå†¤å®¶çš„äº’å‹•ï¼Œæ„å¤–åœ°æˆç‚ºäº†æœ¬é›†æœ€å¤§çš„äº®é»ã€‚',
        'ç‰¹åˆ¥ç¯‡å°‡é€™æ®µæˆ€æ„›æ•…äº‹æ¨å‘äº†æœ€é«˜æ½®ï¼Œç™½éŠ€èˆ‡è¼å¤œçµ‚æ–¼åœ¨ç…™ç«å¤§æœƒä¸Šï¼Œé¼“èµ·å‹‡æ°£ç‰½èµ·äº†å½¼æ­¤çš„æ‰‹ã€‚é€™æ—¢æ˜¯å‘Šç™½çš„çµæŸï¼Œä¹Ÿæ˜¯æˆ€äººçš„é–‹å§‹ã€‚'
    ],
    'Fate': [
        'åœ¨ç„¡äººçš„å»¢æ£„å·¥å» ä¸­ï¼Œç‹‚æˆ°å£«è·éšçš„å‚‘å…‹èˆ‡é¨å…µè·éšçš„å¸Œæ³¢å‘‚å¿’å±•é–‹äº†ç¬¬ä¸€æ¬¡äº¤é‹’ã€‚å¯¶å…·èˆ‡å¯¶å…·çš„ç¢°æ’ç”¢ç”Ÿäº†å·¨å¤§çš„é­”åŠ›æ´ªæµï¼Œé©šå‹•äº†é›ªåŸå¸‚çš„æ‰€æœ‰å‹¢åŠ›ã€‚',
        'å‰çˆ¾ä¼½ç¾ä»€ç«™åœ¨é«˜æ¨“é ‚ç«¯ï¼Œä¿¯ç°è‘—é€™å ´è™›å‡çš„è–æ¯æˆ°çˆ­ï¼Œè‡‰ä¸Šéœ²å‡ºäº†æ„‰æ‚…çš„ç¬‘å®¹ã€‚ä»–æ±ºå®šè¦ªè‡ªä¸‹å ´ï¼Œæ¸¬è©¦ä¸€ä¸‹é€™ç¾¤ã€Œé›œç¨®ã€æ˜¯å¦æœ‰è³‡æ ¼å–æ‚…æœ¬ç‹ã€‚',
        'è­¦å¯Ÿå±€é•·å°æ–¼å¸‚å…§ç™¼ç”Ÿçš„å¤šèµ·è¶…è‡ªç„¶çˆ†ç‚¸äº‹ä»¶æ„Ÿåˆ°ç„¦é ­çˆ›é¡ï¼Œæ®Šä¸çŸ¥ä»–çš„éƒ¨ä¸‹ä¸­æ—©å°±æ··å…¥äº†ç‚ºäº†è–æ¯è€Œä¾†çš„é­”è¡“å¸«æ®ºæ‰‹ã€‚',
        'çœŸçš„ Archer çµ‚æ–¼ç¾èº«ï¼Œå…¶æ­£é«”ç«Ÿç„¶æ˜¯å¸Œè‡˜ç¥è©±ä¸­çš„å¤§è‹±é›„æµ·å…‹åŠ›æ–¯ï¼ˆAlceidesï¼‰ã€‚ä»–æ¨æ£„äº†ç¥æ€§èˆ‡æ¦®è€€ï¼Œä»¥å¾©ä»‡è€…çš„å§¿æ…‹ç™¼èª“è¦å°‡é€™å ´æ‰­æ›²çš„æˆ°çˆ­ç‡ƒç‡’æ®†ç›¡ã€‚'
    ],
    'ç›¸åçš„ä½ å’Œæˆ‘': [
        'éˆ´æœ¨ç‚ºäº†åœ¨å³å°‡åˆ°ä¾†çš„æ ¡å¤–æ•™å­¸ä¸­èˆ‡è°·åŒä¸€çµ„ï¼Œå±•é–‹äº†ä¸€é€£ä¸²å……æ»¿å¿ƒæ©Ÿå»åˆç ´ç¶»ç™¾å‡ºçš„ä½œæˆ°ã€‚è°·å…¶å¯¦æ—©å°±çœ‹ç©¿äº†ä¸€åˆ‡ï¼Œå»é‚„æ˜¯æº«æŸ”åœ°é…åˆè‘—å¥¹ã€‚',
        'å…©äººç¬¬ä¸€æ¬¡åœ¨æ”¾å­¸å¾Œä¸€èµ·å»åƒé€Ÿé£Ÿåº—ï¼Œè°·é¢å°éˆ´æœ¨é‚£äº›é€™ä¸–ä»£çš„æµè¡Œèªæ„Ÿåˆ°ä¸çŸ¥æ‰€æªï¼Œä½†ä»–åŠªåŠ›æƒ³è¦ç†è§£éˆ´æœ¨çš„ä¸–ç•Œçš„æ¨£å­ï¼Œè®“éˆ´æœ¨å¿ƒå‹•ä¸å·²ã€‚',
        'æœŸä¸­è€ƒå°‡è¿‘ï¼Œéˆ´æœ¨é‚€è«‹è°·ä¾†å®¶è£¡é–‹è®€æ›¸æœƒã€‚åœ¨ç‹¹å°çš„æˆ¿é–“è£¡ï¼Œå…©äººçš„è·é›¢ç¬é–“æ‹‰è¿‘ï¼Œæ›–æ˜§çš„æ°£æ°›è®“é€£ç©ºæ°£éƒ½è®Šå¾—ç”œè†©èµ·ä¾†ã€‚',
        'æƒ…äººç¯€åˆ°äº†ï¼Œéˆ´æœ¨è¦ªæ‰‹åšäº†æœ¬å‘½å·§å…‹åŠ›æƒ³è¦é€çµ¦è°·ï¼Œå»å› ç‚ºå¤ªå®³ç¾è€Œä¸€ç›´é€ä¸å‡ºå»ã€‚æœ€å¾Œåœ¨å¤•é™½ä¸‹çš„å…¬åœ’ï¼Œè°·ä¸»å‹•ä¼¸å‡ºäº†æ‰‹ï¼Œæ¥éäº†é€™ä»½æ²‰ç”¸ç”¸çš„å¿ƒæ„ã€‚'
    ],
    'å…¬ä¸»æ®¿ä¸‹': [
        'ä»Šå¤©çš„æ‹·å•ä¸»é¡Œæ˜¯ã€Œå‰›å‡ºçˆçš„èœœç³–åå¸ã€ã€‚é­”ç‹è»ç‰¹åœ°è«‹ä¾†äº†é­”ç•Œé¦–å±ˆä¸€æŒ‡çš„éºµåŒ…å¸«å‚…ç¾å ´çƒ˜ç„™ï¼Œé‚£æ¿ƒéƒçš„é¦™æ°£è®“å…¬ä¸»åœ¨äº”ç§’å…§å°±äº¤å‡ºäº†åŸå ¡çš„ç§˜å¯†é€šé“åœ–ã€‚',
        'ç‚ºäº†è®“å…¬ä¸»æ‹›ä¾›è–åŠçš„å¼±é»ï¼Œæ‰˜çˆ¾ä¸˜ç‰¹åœ°æº–å‚™äº†ç¾ä»£æ—¥æœ¬çš„éŠæˆ²æ©Ÿã€‚å¾æœªç©éé›»å­éŠæˆ²çš„å…¬ä¸»ç¬é–“æ²‰è¿·å…¶ä¸­ï¼Œç‚ºäº†å¤šç©ä¸€å°æ™‚ï¼Œå¥¹æ¯«ä¸çŒ¶è±«åœ°å‡ºè³£äº†çˆ¶ç‹ã€‚',
        'é­”ç‹çš„å¥³å…’ä¹Ÿæ˜¯å…¬ä¸»çš„æœ‹å‹ï¼Œå…©äººä¸€èµ·èˆ‰è¾¦äº†ç¡è¡£æ´¾å°ã€‚åœ¨æ•é ­å¤§æˆ°èˆ‡æˆ€æ„›è©±é¡Œçš„æ”»å‹¢ä¸‹ï¼Œå…¬ä¸»ä¸å°å¿ƒé€éœ²äº†ç‹åœ‹é¨å£«åœ˜é•·çš„ç¾æ¥ç¶½è™Ÿã€‚',
        'æœ¬æ¬¡çš„æ‹·å•æ˜¯ç”¨é ‚ç´šæº«æ³‰æ‹›å¾…å…¬ä¸»ã€‚åœ¨èˆ’é©çš„ç†±æ°´ä¸­ï¼Œå…¬ä¸»èº«å¿ƒæ”¾é¬†åˆ°äº†æ¥µé»ï¼Œç”šè‡³ä¸»å‹•æè­°è¦å¸¶é­”ç‹è»å»åƒè§€ç‹åœ‹çš„çš‡å®¶å¯¶åº«ï¼Œåªç‚ºäº†æ›å–ä¸€ç“¶å†°ç‰›å¥¶ã€‚'
    ]
};

// 3. Update Loop
const updateVolume = (vol) => {
    const slug = `jan-2026-weekly-vol-${vol}`;
    const date = `2026-01-${vol * 7}`;

    let content = `1æœˆæ–°ç•ªé€²å…¥ç¬¬ ${vol} é€±ï¼Œæœ¬é€±çš„æ›´æ–°é‡é»é€Ÿå ±ä¾†äº†ï¼\n\n`;

    const itemList = [
        { k: 'è‘¬é€çš„èŠ™è‰è“®', u: 'https://www.myvideo.net.tw/details/4/32568' },
        { k: 'æˆ‘æ¨çš„å­©å­', u: 'https://www.myvideo.net.tw/details/3/23277' },
        { k: 'å’’è¡“è¿´æˆ°', u: 'https://www.myvideo.net.tw/details/4/24125' },
        { k: 'ç‡ƒæ²¹è»Šé¬¥é­‚', u: 'https://www.myvideo.net.tw/details/4/28879' },
        { k: 'æ³›è€Œä¸ç²¾', u: 'https://www.myvideo.net.tw/details/3/32390' },
        { k: 'åˆ¤è™•å‹‡è€…åˆ‘', u: 'https://www.myvideo.net.tw/details/3/32447' },
        { k: 'è¼å¤œå§¬', u: 'https://www.myvideo.net.tw/details/3/32347' },
        { k: 'Fate', u: 'https://www.myvideo.net.tw/details/3/29508' },
        { k: 'ç›¸åçš„ä½ å’Œæˆ‘', u: 'https://www.myvideo.net.tw/details/3/32423' },
        { k: 'å…¬ä¸»æ®¿ä¸‹', u: 'https://www.myvideo.net.tw/details/3/26411' }
    ];

    itemList.forEach(item => {
        // Use full title? 
        // Need full title for Header.
        // Let's get full title from myvideo_library or just hardcode map?
        // Using simple map for display.
        const displayTitleMap = {
            'è‘¬é€çš„èŠ™è‰è“®': 'è‘¬é€çš„èŠ™è‰è“® ç¬¬äºŒå­£',
            'æˆ‘æ¨çš„å­©å­': 'æˆ‘æ¨çš„å­©å­ ç¬¬äºŒå­£',
            'å’’è¡“è¿´æˆ°': 'å’’è¡“è¿´æˆ° æ­»æ»…è¿´æ¸¸ å‰ç¯‡',
            'ç‡ƒæ²¹è»Šé¬¥é­‚': 'ç‡ƒæ²¹è»Šé¬¥é­‚ ç¬¬ä¸‰å­£',
            'æ³›è€Œä¸ç²¾': 'æ³›è€Œä¸ç²¾çš„æˆ‘è¢«é€å‡ºäº†å‹‡è€…éšŠä¼',
            'åˆ¤è™•å‹‡è€…åˆ‘': 'åˆ¤è™•å‹‡è€…åˆ‘',
            'è¼å¤œå§¬': 'è¼å¤œå§¬æƒ³è®“äººå‘Šç™½ï¼Ÿç‰¹åˆ¥ç¯‡ã€Œé‚å‘å¤§äººçš„éšæ¢¯ã€',
            'Fate': 'Fate/strange Fake',
            'ç›¸åçš„ä½ å’Œæˆ‘': 'ç›¸åçš„ä½ å’Œæˆ‘',
            'å…¬ä¸»æ®¿ä¸‹': 'å…¬ä¸»æ®¿ä¸‹ï¼Œã€Œæ‹·å•ã€çš„æ™‚é–“åˆ°äº† ç¬¬äºŒå­£'
        };

        const displayTitle = displayTitleMap[item.k] || item.k;
        const epContent = genText(displayTitle, vol, plots[item.k][vol - 1]);
        const imgUrl = getImg(item.k);

        content += `## ${displayTitle} (EP.${vol})\n\n`;
        // Standard Markdown Image (Centered by default in Markdown renderer block)
        if (imgUrl) content += `![${displayTitle}æœ¬é€±åŠ‡ç…§](${imgUrl})\n\n`;
        content += `${epContent}\n\n`;
        content += `<a href="${item.u}" class="btn-orange-small" target="_blank">å‰å¾€MyVideoç·šä¸Šè§€çœ‹</a>\n\n`;
        content += `---\n\n`;
    });

    // Update DB
    // Preserve image_url logic from DB if exists (which it does from `assign_unique_images.js`)
    // But `assign_unique_images` was run. We should fetch it.
    const row = db.prepare('SELECT image_url FROM articles WHERE slug = ?').get(slug);
    const coverImg = row ? row.image_url : fallbackImg;

    const stmt = db.prepare(`REPLACE INTO articles (title, content, category, slug, published_at, is_pinned, image_url, excerpt) VALUES (?, ?, ?, ?, ?, ?, ?, ?)`);
    stmt.run(`ã€1æœˆæ–°ç•ªé€±å ±ã€‘Vol.${vol}ï¼šæœ¬é€±æ›´æ–°é‡é»é€Ÿå ±`, content, 'ç·¨è¼¯ç²¾é¸', slug, date, 0, coverImg, `æœ¬é€± Vol.${vol} é‡é»å‹•ç•«æ›´æ–°æƒ…å ±ï¼`);
    console.log(`âœ… Updated Vol.${vol} with Episodic Content.`);
};

// Run for 4 vols
for (let i = 1; i <= 4; i++) updateVolume(i);
